{include file="include/old_trident_header.html"}
<div class="mainContent" >
	<div class="w1200">
		<form>
		<div class="filterBar underline">
			
				<ul class="index_tabnav lt">
					<li>
						<a href="javascript:void(0)" class="cur iAppGroup" data-group="0" onclick="EAS.GODMClick({literal}{{/literal}'adtag':'PC.myapp_change_appkind_0'{literal}}{/literal})">全部</a>
					</li>
					
					{foreach from=$appKind key=key item=item}
					<li>
						<a href="javascript:void(0)" class="iAppGroup" data-group="{$key}" onclick="EAS.GODMClick({literal}{{/literal}'adtag':'PC.myapp_change_appkind_{$key}'{literal}}{/literal})">{$item}</a>
					</li>
					{/foreach}
					
				</ul>
			<!-- {if $aclGroup.modules|strstr:'2027' !== false}<p class="rt"><a href='index.php?module=totalApp&action=totalDevAppList'><i class="icon-user"></i>　研发者 </a></p>{/if} -->
			<input type="hidden" name="iAppGroup">
		</div>
		<div class="filterBar">
			<div class="filer">
			
				按使用习惯排序
			<!--<select name='sort_kind'>

				<option value='1'>按试用习惯排序</option>
				<option value='2'>按收藏排序</option>
			</select>-->
			<a target="search" data-rel="showData" data-form="pageForm" style="display:none;" id='searchClick'> 搜 索 </a>
			
			</div>
			<p class="rt">您的位置：<a href="index.php?module=totalApp&action=totalAppList">首页</a> 》我的应用 </p>
		</div>
		</form>
		<div id="showData">
		<ul class="list_v">
			{foreach from=$putData item=item name=foolist}
				<li id="appList_{$item.iAppId}">
					{if $item.iLogoApply==2}<span class="devlogo icon_index bg{$item.iLogoColorIndex}  {if $item.sAppLogoTxt|@strlen>=10}pr{/if}">{if $item.sAppLogoTxt|@strlen>=10}<span class="devlogo fontsize4">{$item.sAppLogoTxt}</span>{else}{$item.sAppLogoTxt}{/if}</span>{elseif $item.iLogoApply==1}<img class="devlogo" src="{$item.sAppLogo}">{/if}
					
					<h2>{if $item.sAppName|@mb_strlen>9}{$item.sAppName|mb_substr:0:8:'utf-8'}…{else}{$item.sAppName}{/if}</h2>
					<p>{if $item.iAuthState==2 && $item.iLoginByQQ == 0}权限有效期至：{$item.dtAuthEndDate}{elseif $item.iAuthState==1}权限有效期至：请等待审核{else}&nbsp;{/if}</p>
					<p>使用次数：<span id='useTime_{$item.id}'>{$item.iUseTimes}</span></p>
					<p class="button">
					<!-- 	{if $item.iAuthState==2}
							<a href="{$item.sAppUrl}" class="btn_use" target='_blank' onclick="addUseTime({$item.id})">立即使用</a>
						{elseif $item.iAuthState==1}
							<a href="javascript:viod(0)" class="btn_use" >权限审核中</a>
						{elseif $item.iAuthState==0 && $item.iLoginByQQ==1}
							<a href="javascript:viod(0)" class="btn_use" >绑定QQ</a>
						{elseif $item.iAuthState==0 && $item.iPlatID >0}
							<a href="javascript:viod(0)" class="btn_use" >申请开通</a>
						{else}
							<a href="javascript:viod(0)" class="btn_use" >立即使用</a>
						{/if} -->
						
						<a class="btn_use authState" style='{if ($item.iAuthState == 0) && $item.iPlatID && $item.iLoginByQQ==0}display:block;{/if}' data-confirm=0 target='ajax' data-aftfunc='showDialog' data-aftparams='{literal}{{/literal}"iAppId":{$item.iAppId},"appName":"{$item.sAppName}"{literal}}{/literal}'  href='index.php?module=totalApp&action=totalAppList&func=applyAuthCheck&iAppId={$item.iAppId}&PlatID={$item.iPlatID}&iIsPlatToService={$item.iIsPlatToService}' onclick="EAS.GODMClick({literal}{{/literal}'adtag':'PC.myapp_apply_{$item.iAppId}'{literal}}{/literal})"><i class="icon-edit"></i>申请开通</a>

					
						<a class="btn_use authState" href="javascript:void(0)" {if $item.iAuthState == 1}style='display:block;'{/if}><i class="icon-edit"></i>审核中……</a>

						<a class="btn_use authState" href="{$item.sAppUrl}" {if $item.iAuthState == 2 || ($item.iPlatID == 0 && $item.iLoginByQQ==0)}style='display:block;'{/if} target="_blank" onclick="addUseTime({$item.id},1);EAS.GODMClick({literal}{{/literal}'adtag':'PC.myapp_use_{$item.iAppId}'{literal}}{/literal})"><i class="icon-edit"></i>立即使用</a>
						<a class="btn_use authState" style='{if ($item.iAuthState == 0) && $item.iLoginByQQ==1}display:block;{/if}' data-confirm=0 target='ajax' data-aftfunc='showDialog' data-aftparams='{literal}{{/literal}"iAppId":{$item.iAppId},"appName":"{$item.sAppName}"{literal}}{/literal}'  href='index.php?module=totalApp&action=totalAppList&func=applyAuthCheck&iAppId={$item.iAppId}&PlatID={$item.iPlatID}&iIsPlatToService={$item.iIsPlatToService}&iLoginByQQ={$item.iLoginByQQ}' onclick="EAS.GODMClick({literal}{{/literal}'adtag':'PC.myapp_apply_{$item.iAppId}'{literal}}{/literal})"><i class="icon-edit"></i>绑定QQ</a>


						<!--<span id='myAppid_{$item.id}'><a target="html" data-rel="myAppid_{$item.id}" href="index.php?module=myApp&action=appList&func=collectMyApp&myAppId={$item.id}" {if $item.iCommonUse>0}class="btn_col collected">已收藏{else} class="btn_col">收藏{/if}</a></span>-->
					</p>
					<div style='display:none' class='diaOption'>
						<option selected="" value="0">请选择你申请的权限角色</option>
						{foreach from=$item.sRoleIDList item=item1 key=key}
							<option value="{$key}">{$item1}</option>
						{/foreach}
					</div>
					<input type='hidden' value='index.php?module=totalApp&action=totalAppList&func=applyAuth&iAppId={$item.iAppId}&PlatID={$item.iPlatID}&iIsPlatToService={$item.iIsPlatToService}&iLoginByQQ={$item.iLoginByQQ}' class='devFormUrl'>
					<input type='hidden' value='{$item.iLoginByQQ}' id='iLoginByQQ'>
					
					
				</li>
			{/foreach}

			<li class="add_item">
				<a href="index.php?module=totalApp&action=totalAppList"><img src="http://x.ied.com/static/images/icon10.png"></a>			
			</li>
		</ul>
		<div id='page'  class="page pagination" data-type='pagination' style="text-align: center;" data-action="index.php?module=myApp&action=appList" data-rel="showData" data-numshow='5' data-total="{$total}" data-perpage="{$pageSize}" data-current="{$pageCur}"></div>
		</div>
	</div>
</div>
<div class="mobile_right">
<a class="hoverimg"
   data-tp-title="<img src='http://x.ied.com/static/images/qr.png' width='128' height='128'><p class='line-height'>' 扫一扫 '</p><p>移动办公带你飞</p>"
   data-tp-position="bottom" data-tp-container=".mobile_right" data-tp-class="mobile_tips" >
</a> 
</div>
<div id="showMyDialog" style="display:none">
<div class="tips_system">
    <p class="title_tips">系统提示</p>
<form>
    <div class="tips_cont">
    	<div class="lt">
    		<!--<span class="icon_index bg10">LOL</span>-->
    		<p>LOL赛事中心管理端</p>
    	</div>
    	<div class="tips_right">
    		<p id="popsRoleID">
    			<label>权限角色 :</label>
				<select id="u238_input" name='sRoleID'></select>
    		</p>
    		<p id="popauthDesc">
    			<label>申请原因 :</label>
    			<input type="text" class="" data-rd-title="请输入申请原因" name='authDesc'>
    		</p>
    		<p id="popIuin">
    			<label>绑定 QQ :</label>
    			<input type="text" class=""  name='iUin' id='iUintips'>
    		</p>
    		<input type="hidden" id='isQQ' value='0'>
    	</div>
	
		<div class="btn">
			<a href="" class="tips_btn" target="subform" data-prefunc='beforeSubmit'>确定</a><a href="javascript:Trident.closeAll();" class="cancel">取消</a>
		</div>
       
    </div>
</form>
</div>
</div>
{literal}
<style>
	.authState {display: none;}

</style>
<script>
Trident.ready(function(){
    $('select[name=sort_kind]').on('change',function(){
    	$('#searchClick').click();
    });

    $('.iAppGroup').click(function(){
    	$('input[name=iAppGroup]').val($(this).attr('data-group'));
    	$(this).addClass('cur').parent('li').siblings('li').find('a').removeClass('cur');
    	$('#searchClick').click();
    });

    $('.devlogo').click(function(){
    	$(this).parent('li').find('.authState').each(function(){
    		if($(this).css('display') == 'block' && $(this).attr('target') == '_blank'){
    			window.open($(this).attr('href'));
    		}
    	});
    });
    
});


function showDialog(e,a){

		if(a.retCode==1){
			alert(a.retInfo+'是否开通本系统权限');
			return;
		}
		var iAppId = e.iAppId;
		var appName = e.appName;
		var diaDom = $('#appList_'+iAppId);

		if(a.insert == 1){
			if(a.iAuthState == 2){
				$('#appList_'+iAppId+' .authState').hide();
				$('#appList_'+iAppId+' .authState').eq(2).show();
			}else{
				$('#appList_'+iAppId+' .authState').hide();
				$('#appList_'+iAppId+' .authState').eq(1).show();
			}
		}else{
			// var diaDom = dom.children('.devlogo').clone();
			$('#showMyDialog .lt .devlogo').remove();
			$('#showMyDialog .lt p').before(diaDom.children('.devlogo').clone());
			$('#showMyDialog .lt p').html(appName);
			$('#u238_input').html(diaDom.find('.diaOption').html());
			if(diaDom.find('#iLoginByQQ').val() != 1){
				$('#popIuin').hide();
				$('#popauthDesc').show();
				$('#popsRoleID').show();
				$('#isQQ').val(0);
			}else{
				$('#popIuin').show();
				$('#popauthDesc').hide();
				$('#popsRoleID').hide();
				$('#isQQ').val(1);
			}
			$('#showMyDialog a').attr('href',diaDom.find('.devFormUrl').val());
	    	Trident.tpop('showMyDialog');
		}


		
    }

 function beforeSubmit(e){
	if($('#isQQ').val() == 1){
		if($('input[name=iUin]').val().length <1 ){
			Trident.tip(0,'iUintips','请输入正确的QQ号','top');
			return false;
		}else{
			return true;
		}
	}else{
		if($('#u238_input').val() == 0){
		Trident.tip(0,'u238_input','请选择你申请的权限角色','top');
		return false;
		}
	}
	
	
}

//用于表单提交成功后的无刷新页面功能实现
function afterSubmit(e){
	if(e.retCode == 0){
		Trident.closeAll();
		if(e.iAuthState == 2){
		
			$('#appList_'+e.iAppId+' .authState').hide();
			$('#appList_'+e.iAppId+' .authState').eq(2).show();
		}else{

			$('#appList_'+e.iAppId+' .authState').hide();
			$('#appList_'+e.iAppId+' .authState').eq(1).show();
		}
		
	}
	
}
</script>
{/literal}
{include file="include/footer.html"}





















