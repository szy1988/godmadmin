{include file="include/old_trident_header_dev.html"}
<div class="mainContent" >
	<div class="w1200">
		<div class="filterBar underline">

            <ul class="index_tabnav lt">
                <li>
                    <a href="index.php?module=myApp&action=cgiList" >组件</a>
                </li>
                <li>
                    <a href="#" class="cur">工具</a>
                </li>
            </ul>
        </div>
		<div class="filterBar">
			<div class="filer">
			<form>
				按使用习惯排序
			<!--<select name='sort_kind'>

				<option value='1'>按试用习惯排序</option>
				<option value='2'>按收藏排序</option>
			</select>-->
			<a target="search" data-rel="showData" data-form="pageForm" style="display:none;" id='searchClick'> 搜 索 </a>
			</form>
			</div>
			<!-- <p class="rt">您的位置：<a href="index.php?module=totalApp&action=totalAppList">首页</a> 》我的应用 </p> -->
		</div>
		<div id="showData">
		<ul class="list_v">
			{foreach from=$putData item=item name=foolist}
				<li id="appList_{$item.iAppId}">
					{if $item.iLogoApply==2}<span class="devlogo icon_index bg{$item.iLogoColorIndex}  {if $item.sAppLogoTxt|@strlen==12}pr{/if}">{if $item.sAppLogoTxt|@strlen==12}<span class="devlogo fontsize4">{$item.sAppLogoTxt}</span>{else}{$item.sAppLogoTxt}{/if}</span>{elseif $item.iLogoApply==1}<img class="devlogo" src="{$item.sAppLogo}">{/if}
					
					<h2>{if $item.sAppName|@mb_strlen>9}{$item.sAppName|mb_substr:0:8:'utf-8'}…{else}{$item.sAppName}{/if}</h2>
					<p>{if $item.iAuthState==2 && $item.iLoginByQQ == 0}权限有效期至：{$item.dtAuthEndDate}{elseif $item.iAuthState==1}权限有效期至：请等待审核{else}&nbsp;{/if}</p>
					<p>使用次数：<span id='useTime_{$item.id}'>{$item.iUseTimes}</span></p>
					<p class="button">
						<a class="btn_use authState" href="{$item.sAppUrl}" {if $item.iAuthState == 2 || $item.iLoginByQQ==0}style='display:block;'{/if} target="_blank" onclick="addUseTime({$item.id},1);EAS.GODMClick({literal}{{/literal}'adtag':'PC.mytool_use_{$item.iAppId}'{literal}}{/literal})"><i class="icon-edit"></i>立即使用</a>
						<a class="btn_use authState" style='{if ($item.iAuthState == 0) && $item.iLoginByQQ==1}display:block;{/if}' data-confirm=0 target='ajax' data-aftfunc='showDialog' data-aftparams='{literal}{{/literal}"iAppId":{$item.iAppId},"appName":"{$item.sAppName}"{literal}}{/literal}'  href='index.php?module=totalApp&action=totalAppList&func=applyAuthCheck&iAppId={$item.iAppId}&PlatID={$item.iPlatID}&iIsPlatToService={$item.iIsPlatToService}&iLoginByQQ={$item.iLoginByQQ}'><i class="icon-edit"></i>绑定QQ</a>
						
						<!--<span id='myAppid_{$item.id}'><a target="html" data-rel="myAppid_{$item.id}" href="index.php?module=myApp&action=appList&func=collectMyApp&myAppId={$item.id}" {if $item.iCommonUse>0}class="btn_col collected">已收藏{else} class="btn_col">收藏{/if}</a></span>-->
					</p>
					<div style='display:none' class='diaOption'>
						<option selected="" value="0">请选择你申请的权限角色</option>
						{foreach from=$item.sRoleIDList item=item1 key=key}
							<option value="{$key}">{$item1}</option>
						{/foreach}
					</div>
					<input type='hidden' value='index.php?module=totalApp&action=totalDevAppList&func=applyAuth&iAppId={$item.iAppId}&PlatID={$item.iPlatID}&iIsPlatToService={$item.iIsPlatToService}&iLoginByQQ={$item.iLoginByQQ}' class='devFormUrl'>
					<input type='hidden' value='{$item.iLoginByQQ}' id='iLoginByQQ'>
					
				</li>
			{/foreach}

			<li class="add_item">
				<a href="index.php?module=totalApp&action=totalDevAppList"><img src="http://x.ied.com/static/images/icon10.png"></a>			
			</li>
		</ul>
		<div id='page' class="page pagination" data-type='pagination' style="text-align: center;" data-action="index.php?module=myApp&action=devAppList" data-rel="showData" data-numshow='5' data-total="{$total}" data-perpage="{$pageSize}" data-current="{$pageCur}"></div>
		</div>
	</div>
</div>
<div id="showMyDialog" style="display:none">
<div class="tips_system">
    <p class="title_tips">系统提示</p>
<form>
    <div class="tips_cont">
    	<div class="lt">
    		<!--<span class="icon_index bg10">LOL</span>-->
    		<p>LOL赛事中心管理端</p>
    	</div>
    	<div class="tips_right">
    		<p id="popsRoleID">
    			<label>权限角色 :</label>
				<select id="u238_input" name='sRoleID'></select>
    		</p>
    		<p id="popauthDesc">
    			<label>申请原因 :</label>
    			<input type="text" class="" data-rd-title="请输入申请原因" name='authDesc'>
    		</p>
    		<p id="popIuin">
    			<label>绑定 QQ :</label>
    			<input type="text" class=""  name='iUin' id='iUintips'>
    		</p>
    		<input type="hidden" id='isQQ' value='0'>
    	</div>
	
		<div class="btn">
			<a href="" class="tips_btn" target="subform" data-prefunc='beforeSubmit'>确定</a><a href="javascript:Trident.closeAll();" class="cancel">取消</a>
		</div>
       
    </div>
</form>
</div>
</div>
{literal}
<style>
	.authState {display: none;}
</style>
<script>
Trident.ready(function(){
    $('select[name=sort_kind]').on('change',function(){
    	$('#searchClick').click();
    });
    $('.devlogo').click(function(){
    	$(this).parent('li').find('.authState').each(function(){
    		if($(this).css('display') == 'block' && $(this).attr('target') == '_blank'){
    			window.open($(this).attr('href'));
    		}
    	});
    });
});

function showDialog(e,a){

		if(a.retCode==1){
			alert(a.retInfo+'是否开通本系统权限');
			return;
		}
		var iAppId = e.iAppId;
		var appName = e.appName;
		var diaDom = $('#appList_'+iAppId);

		if(a.insert == 1){
			if(a.iAuthState == 2){
				$('#appList_'+iAppId+' .authState').hide();
				$('#appList_'+iAppId+' .authState').eq(2).show();
			}else{
				$('#appList_'+iAppId+' .authState').hide();
				$('#appList_'+iAppId+' .authState').eq(1).show();
			}
		}else{
			// var diaDom = dom.children('.devlogo').clone();
			$('#showMyDialog .lt .devlogo').remove();
			$('#showMyDialog .lt p').before(diaDom.children('.devlogo').clone());
			$('#showMyDialog .lt p').html(appName);
			$('#u238_input').html(diaDom.find('.diaOption').html());
			if(diaDom.find('#iLoginByQQ').val() != 1){
				$('#popIuin').hide();
				$('#popauthDesc').show();
				$('#popsRoleID').show();
				$('#isQQ').val(0);
			}else{
				$('#popIuin').show();
				$('#popauthDesc').hide();
				$('#popsRoleID').hide();
				$('#isQQ').val(1);
			}
			$('#showMyDialog a').attr('href',diaDom.find('.devFormUrl').val());
	    	Trident.tpop('showMyDialog');
		}


		
    }

 function beforeSubmit(e){
	if($('#isQQ').val() == 1){
		if($('input[name=iUin]').val().length <1 ){
			Trident.tip(0,'iUintips','请输入正确的QQ号','top');
			return false;
		}else{
			return true;
		}
	}else{
		if($('#u238_input').val() == 0){
		Trident.tip(0,'u238_input','请选择你申请的权限角色','top');
		return false;
		}
	}
	
	
}

//用于表单提交成功后的无刷新页面功能实现
function afterSubmit(e){
	if(e.retCode == 0){
		Trident.closeAll();
		if(e.iAuthState == 2){
		
			$('#appList_'+e.iAppId+' .authState').hide();
			$('#appList_'+e.iAppId+' .authState').eq(2).show();
		}else{

			$('#appList_'+e.iAppId+' .authState').hide();
			$('#appList_'+e.iAppId+' .authState').eq(1).show();
		}
		
	}
	
}
</script>
{/literal}
{include file="include/footer.html"}





















